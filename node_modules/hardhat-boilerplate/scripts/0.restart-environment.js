const colors = require('colors');

const verifier = require('./verifier');
const moralis = require('./moralis/utils/moralisUtils');

async function restartServer() {
  const options = { useMasterKey: true };
  console.log('-------------Re-Initializing server-------------'.green);
  await moralis.initialize(options);
  await moralis.bulkDelete('Whitelist', [{ filter: {} }], options);
  await moralis.bulkDelete('MintedTokens', [{ filter: {} }], options);
  await moralis.bulkDelete('VillainsTransfers', [{ filter: {} }], options);
  await moralis.bulkDelete('SeedNumberAssigned', [{ filter: {} }], options);
  await moralis.bulkDelete('Villains', [{ filter: {} }], options);
  await moralis.bulkDelete('Stage', [{ filter: {} }], options);

  await moralis.unwatchEvent('SeedNumberAssigned');
  await moralis.unwatchEvent('MintedTokens');
  await moralis.unwatchEvent('VillainsTransfers');
  console.log('-------------Server was re-initialized successfully-------------'.green);
}

async function main() {
  colors.enable();
  try {
    const moralisSettings = moralis.moralisSettings();
    await verifier.askIsOk([moralisSettings]);
    await restartServer();
  } catch (error) {
    console.error(error);
    throw error;
  }
}

main()
  .then(() => process.exit(0))
  .catch(() => {
    process.exit(1);
  });
