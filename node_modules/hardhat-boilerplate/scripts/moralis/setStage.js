const hre = require('hardhat');
const moralisUtils = require('./utils/moralisUtils');

module.exports.setStage = async (stageSettings, contractsAddressesSettings) => {
  const { name, price, maxAmount, merkleRoot } = stageSettings;
  const options = { useMasterKey: true };
  const [deployer] = await hre.ethers.getSigners();

  console.log(`-------------Setting new stage:${name} on LilVillainsMinter-------------`.green);
  console.group();
  const { minter } = contractsAddressesSettings;
  console.log(`LilVillainsMinter address: ${minter}`.bgBlue);

  const LilVillainsMinter = await ethers.getContractFactory('LilVillainsMinter', deployer);
  const lilVillainsMinter = await LilVillainsMinter.attach(minter);
  await lilVillainsMinter.setStage(name, ethers.utils.parseEther(price), maxAmount, merkleRoot);
  console.groupEnd();
  console.log('-------------Connecting with Moralis Server to set Stage-------------'.green);
  await moralisUtils.initialize(options);
  await moralisUtils.updateStage(name, maxAmount, options);
  console.log('-------------New stage set successfully-------------'.green);
};
